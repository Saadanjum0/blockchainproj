DEPLOYMENT VERIFICATION CHECKLIST - MUST CHECK BEFORE GOING LIVE
=================================================================

CRITICAL: High Gas Fee Error Fix
---------------------------------
The "high gas fee" or "transaction likely to fail" error on processPendingStats 
is caused by incorrect OrderManager linking in RestaurantRegistry/RiderRegistry.

✅ VERIFY ON SEPOLIA ETHERSCAN:

1. RestaurantRegistry (0xAf811C269813701E973DbE9F5a8d8FCAbF031A9c)
   - Go to: https://sepolia.etherscan.io/address/0xAf811C269813701E973DbE9F5a8d8FCAbF031A9c#readContract
   - Call: orderManager()
   - MUST EQUAL: 0xbFaA4B0F03a8A9c82a3c50554a801Bbe8b32186a
   
   If NOT correct:
   - Go to Write Contract tab
   - Call: updateOrderManager(0xbFaA4B0F03a8A9c82a3c50554a801Bbe8b32186a)
   - Sign transaction

2. RiderRegistry (0x382a67Acb71094ba711EeC95D2b5F0652cafc677)
   - Go to: https://sepolia.etherscan.io/address/0x382a67Acb71094ba711EeC95D2b5F0652cafc677#readContract
   - Call: orderManager()
   - MUST EQUAL: 0xbFaA4B0F03a8A9c82a3c50554a801Bbe8b32186a
   
   If NOT correct:
   - Go to Write Contract tab
   - Call: setOrderManager(0xbFaA4B0F03a8A9c82a3c50554a801Bbe8b32186a)
   - Sign transaction

3. RoleManager Authorization
   - Go to: https://sepolia.etherscan.io/address/0x870dC762278744DB705333Be2B107b91AfB1B0a3#readContract
   - Call: authorizedContracts(0xAf811C269813701E973DbE9F5a8d8FCAbF031A9c) → MUST be true
   - Call: authorizedContracts(0x382a67Acb71094ba711EeC95D2b5F0652cafc677) → MUST be true
   - Call: authorizedContracts(0xbFaA4B0F03a8A9c82a3c50554a801Bbe8b32186a) → MUST be true
   
   If any are false:
   - Go to Write Contract tab
   - Call: authorizeContract(address) for each missing one
   - Sign transactions

IPFS CONFIGURATION (CRITICAL FOR CROSS-DEVICE)
-----------------------------------------------

4. Vercel Environment Variables
   ✅ VITE_PINATA_API_KEY must be set
   ✅ VITE_PINATA_SECRET must be set
   ✅ Both must be in Production + Preview + Development
   
   Get keys from: https://pinata.cloud
   
   Without these:
   - Restaurant menus won't work cross-device
   - Orders can't be created
   - Rider data not accessible cross-device

5. Test IPFS After Deployment
   - Register new restaurant
   - Add menu items
   - Open on different device
   - Menu MUST be visible
   - If not → check browser console for "IPFS NOT CONFIGURED" error

CONTRACT ADDRESSES VERIFICATION
--------------------------------

6. Frontend Contract Addresses (frontend/src/contracts/addresses.js)
   ✅ RoleManager: 0x870dC762278744DB705333Be2B107b91AfB1B0a3
   ✅ RestaurantRegistry: 0xAf811C269813701E973DbE9F5a8d8FCAbF031A9c
   ✅ RiderRegistry: 0x382a67Acb71094ba711EeC95D2b5F0652cafc677
   ✅ Escrow: 0xf1F64976B7076274aB6C1fdA74458Cc8baE98b56
   ✅ OrderManager: 0xbFaA4B0F03a8A9c82a3c50554a801Bbe8b32186a

CROSS-DEVICE FUNCTIONALITY
---------------------------

7. Test Restaurant Registration Cross-Device
   Device A: Register restaurant → Upload menu
   Device B: View restaurants → MUST see menu
   
8. Test Order Creation Cross-Device
   Device A: Create order
   Device B (Restaurant): MUST see order
   
9. Test Rider Assignment Cross-Device
   Device A: Register rider
   Device B (Restaurant): MUST see rider in available list

KNOWN ACCEPTABLE BEHAVIORS
---------------------------

10. processPendingStats Transaction
    - Can be rejected/skipped by user
    - Only updates on-chain counters (totalEarnings, totalDeliveries)
    - NOT required for payment (payment happens in confirmDelivery)
    - Restaurant "Total Orders" updates automatically without it
    - If shows "high gas" → verify steps 1-3 above

11. Gas Limit Capping
    - createOrder has 500000n gas limit (normal)
    - processPendingStats has 800000n gas limit (normal)
    - These are CAPS not actual costs
    - Prevents MetaMask over-estimation

TESTING CHECKLIST
-----------------

12. Test Complete Flow (Single Device)
    ✅ Register restaurant
    ✅ Upload menu
    ✅ Register rider
    ✅ Create order (customer)
    ✅ Accept order (restaurant)
    ✅ Mark prepared (restaurant)
    ✅ Assign rider (restaurant)
    ✅ Mark picked up (rider)
    ✅ Mark delivered (rider)
    ✅ Confirm delivery (customer)
    ✅ Verify payment on Etherscan (restaurant + rider)

13. Test Cross-Device (Multiple Devices)
    ✅ Restaurant visible on all devices
    ✅ Menu visible on all devices
    ✅ Orders visible on restaurant device
    ✅ Rider visible on restaurant device
    ✅ Order details accessible from rider device

14. Etherscan Verification
    ✅ Customer payment visible in Escrow contract
    ✅ Payment release visible (internal txns)
    ✅ Restaurant received 80%
    ✅ Rider received 10%
    ✅ Platform received 10%

COMMON ISSUES & FIXES
----------------------

Issue: "High gas fee error" on new device
Fix: Verify steps 1-3 (OrderManager linking)
Can also: Just reject the transaction (it's optional)

Issue: Menu not visible on other device
Fix: Verify step 4 (IPFS configuration)
     Re-upload menu from original device

Issue: "IPFS NOT CONFIGURED" error
Fix: Add Pinata env vars to Vercel (step 4)
     Redeploy application

Issue: Order details not loading
Fix: Check browser console
     If "INVALID IPFS HASH" → order created before IPFS config
     Future orders will work correctly

Issue: Role selection screen keeps appearing
Fix: Check browser console for role detection timeout
     Increase timeout or check RPC connectivity
     Or clear browser cache and reconnect wallet

FINAL CHECKS BEFORE MARKING "PRODUCTION READY"
-----------------------------------------------

✅ All contract addresses correct in frontend
✅ OrderManager linked in RestaurantRegistry (step 1)
✅ OrderManager linked in RiderRegistry (step 2)
✅ RoleManager authorized all contracts (step 3)
✅ IPFS (Pinata) configured on Vercel (step 4)
✅ Application deployed on Vercel
✅ Tested restaurant registration cross-device (step 7)
✅ Tested order creation cross-device (step 8)
✅ Tested rider visibility cross-device (step 9)
✅ Tested complete order flow (step 12)
✅ Verified payments on Etherscan (step 14)
✅ No "IPFS NOT CONFIGURED" errors
✅ No persistent "high gas fee" errors (or verified as optional)

NOTES
-----
- processPendingStats is OPTIONAL (can be skipped)
- Restaurant "Total Orders" updates without it (uses OrderManager data)
- Rider balance visible on MetaMask/Etherscan immediately after delivery
- On-chain counters (totalEarnings in RiderRegistry) update via processPendingStats
- If processPendingStats fails → users can manually refresh to see updated stats

STATUS: Ready for deployment after completing checklist above

